---
title: "Body Image Analysis Report"
author: "Jacob Dink"
date: "April 7, 2015"
output:
  html_document:
    fig_height: 4
    fig_width: 7
---

## Data Loading & Cleaning

### Load:

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# DON'T FORGET: SESSION->SET-WORKING-DIRECTORY->SOURCE-FILE-LOCATION
packs = lapply(X = c('readr', 'plyr', 'dplyr', 'pbapply', 'tidyr', 'ggplot2', 'broom', 'lme4'), FUN = require, character.only=TRUE)

# source('load_and_clean_bi_data_from_scratch.R') # <--- only run once
df3 = readRDS("./data/cleaned_et_data_w_all_interest_areas.RDS")
data_options = set_data_options(
                 item_columns = "Image",
                 trial_column = "Trial",
                 time_column = "Timestamp",
                 trackloss_column = "Trackloss",
                 participant_column = "Participant", 
                 aoi_columns = c("IA_head","IA_bust","IA_waist","IA_hips","IA_thighs"))

df4 = df3 %>%
  group_by(Participant, Trial) %>%
  mutate(StartTime = Timestamp[Message=="PICTURE"],
         StopTime  = Timestamp[Message=="Time Out"]) %>%
  subset_by_window(data_options, window_start="StartTime", window_end="StopTime")

# 

```

### Trackloss & Exclusions:

We remove participants and trials with high trackloss. We also remove participants for whom we do not have dissatisfaction-rating data. Finally, we remove rows with trackloss, and restrict our analysis to the time the stimulus was on the screen.

```{r, warning=FALSE, message=FALSE}
tl = trackloss_analysis(df4, data_options)
hist(tl$TracklossForParticipant)
df5 = clean_by_trackloss(data = df4, data_options = data_options, participant_z_thresh = 3, trial_z_thresh = 3)
rm(df4,df3); gc()
```

## Analysis

### Measures

In what follows, we'll be correlating some measures of body-dissatisfaction with looking.

* DissBP : Dissatisfaction with a particular body-part.
* DissOverall : The sum of all ratings for all body-parts
* DissNoBP : DissOverall - DissBP. A measure of overall dissatisfaction, excluding dissatifsaction with particular body-part in question.

The idea is to show that 'dissatisfaction with a particular body-part' (DissBP) predicts looking to that body-part, even controlling for overall body-dissatisfaction (DissNoBP).

```{r, warning=FALSE, message=FALSE}
df_measures = read.csv("./data/measures.csv", stringsAsFactors = FALSE) %>%
  select(ID, edibodydistot, bmi, bodysurvobcs, edibdiscontinuous, stomach, thighs, hips, chest) %>% # <---- NOTE no arms
  rename(Participant = ID,
         waist  = stomach,
         bust   = chest) %>%
  gather(BodyPart, DissBP, waist:bust, convert = TRUE) %>%
  mutate(
    Participant = as.character(Participant),
    AOI = paste0("IA_", BodyPart)
    ) %>%
  group_by(Participant) %>%
  mutate(DissOverall = sum(DissBP) 
         ) %>%
  ungroup() %>%
  mutate(DissNoBP = DissOverall - DissBP)

ggplot(df_measures, aes(x = DissBP, y = DissNoBP, group = BodyPart, color = BodyPart)) +
  geom_point(position = position_jitter(.1,.1)) +
  geom_smooth(method="lm") +
  ggtitle("Correlation between Body-Part Diss. and Everything-Else Diss.")

fit_dissatisfaction = lm(formula = DissNoBP ~ DissBP, data = df_measures )
glance(fit_dissatisfaction)

```

We can see that, while there's a correlation with specific dissatisfaction and overall dissatisfaction, there's plenty of independence (once excluding the specific). I.e., the R-squared is low.

### Analysis: How Does Looking Relate to Body-Dissatisfaction?

#### Main Effect:

```{r, message=FALSE}
df_window = window_analysis(data = df5, data_options = data_options, 
                dv = c("IA_bust","IA_waist","IA_hips","IA_thighs") )
df_window = left_join(df_window, df_measures, by = c("Participant", "AOI") )

df_window = center_predictors(df_window, c("DissBP","DissNoBP") )
fit_overall = lmer(formula = ArcSin ~ DissBPC + DissNoBPC + BodyPart + (1+BodyPart|Participant) + (1+BodyPart|Image), 
     REML = FALSE,
     data = df_window)
drop1(fit_overall, test = "Chisq")
```

First, we run an analysis that examines whether dissatisfaction with a particular body part predicts looking at that body part, controlling for overall dissatisfaction.

We see that it does. There's an effect of BP-specific dissatifaction, even controlling for overall dissatisfaction. 

```{r, message=FALSE}
tidy(fit_overall, effects = "fixed")

ggplot(df_window, aes(x = DissBP, y = Prop, group = BodyPart, color = BodyPart)) +
  geom_smooth(method="lm") +
  coord_cartesian(ylim=c(0,.33))
```

Drilling into this a bit, we can see that there's a positive correlation between BP-specific dissatisfaction and looking, and a mild negative correlation between general dissatisfaction and looking.

Graphing the data suggests a possible dissatisfaction-by-bodypart interaction...

#### Interaction:

```{r, message=FALSE}
fit_bpart_int = lmer(formula = ArcSin ~ DissBPC*BodyPart + DissNoBPC + (1+BodyPart|Participant) + (1+BodyPart|Image), 
     REML = FALSE,
     data = df_window)
drop1(fit_bpart_int, test = "Chisq")
```

...however, this is not significant.

Overall, these analyses suggest that dissatisfaction with a body-part predicts overall looking to that body-part (regardless of body-part).

### Analysis: How Does Looking Change over Time?

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#df5$TimeInExp = ifelse(as.numeric(df5$Trial) < 25, "Early","Late")
df_time = time_analysis(data = df5, data_options, time_bin_size = 500, 
                        dv = c("IA_bust","IA_waist","IA_hips","IA_thighs") )
df_time = df_time %>%
  left_join(df_measures, by = c("Participant", "AOI") ) %>%
  filter(!is.na(DissBP))

plot(df_time, data_options, condition_column = "DissBP")

seq_bins = analyze_time_bins(data = df_time, data_options, condition_column = "DissBP", within = FALSE)
plot(seq_bins)

```

Now we'll examine how the relationship between dissatisfaction and looking changes over the course of a trial.

First, we examine these two effects independently.

```{r, message=FALSE}
df_time =center_predictors(df_time, c("DissBP", "DissNoBP", "TimeBin"))
fit_main_diss = lmer(elog ~ DissBPC+TimeBinC + AOI + DissNoBPC + (1+AOI|Participant) + (1+AOI|Image), 
                     REML = FALSE,
                     data = df_time)
drop1(fit_main_diss, test = "Chisq")
```

We still have an effect of dissatisfaction, as well as a large effect of trial-time (people tend to look less as the trial progresses). Nothing interesting here.

```{r, message=FALSE}
fit_int_time_diss = lmer(elog ~ DissBPC*TimeBinC + AOI + DissNoBPC + (1+AOI|Participant) + (1+AOI|Image), 
                     REML = FALSE,
                     data = df_time)
drop1(fit_int_time_diss, test = "Chisq")
```

The result of this test suggests that the relationship between dissatisfaction and looking changes over the course of a trial: people's intial looking gravitates towards low-satisfaction body-parts, but as the trial progresses this behavior lessens.


Here we can see the interaction visually, by performing a median split on high/low dissatisfaction. 

### Analysis: Face vs. Body Looking?

#### Overall Effect:

Previous work has suggested that proportion of time spent looking at the body/face might vary with body-dissatisfaction. Let's see how that hypothesis fares here.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# remove participants/trials with high trackloss, as before
# df_fb = df3 %>%
#   filter(! Participant %in% exclude,
#          ! TrialID %in% exclude_trials,
#          ! Trackloss,
#            TimeInTrial > 0,
#          ! PostTrial) %>%
#   mutate(IA_body = IA_bust | IA_waist | IA_hips | IA_thighs)
# 
# df_fb$FB = 'neither'
# df_fb$FB[df_fb$IA_body] = 'body'
# df_fb$FB[df_fb$IA_head] = 'face'
# table(df_fb$FB) / nrow(df_fb)
# 
# df_omeas = df_measures %>%  # overall measures
#   group_by(Participant) %>% 
#   summarise(bodysurvobcs      = unique(bodysurvobcs), 
#             edibdiscontinuous = unique(edibdiscontinuous),
#             edibodydistot     = unique(edibodydistot),
#             DissOverall       = unique(DissOverall)
#             )
# 
# df_fb = left_join(df_fb, df_omeas, by="Participant") %>%
#   filter( ! is.na(DissOverall),
#           ! is.na(edibdiscontinuous) )
```

```{r}
# (number_of_participants2 = length(unique(df_fb$Participant))) #84
# 
# df_fw = window_analysis(df_fb, data_options, "IA_head", c("DissOverall", "edibdiscontinuous") )
# df_fw$AOI= 'head'
# df_bw = window_analysis(df_fb, data_options, "IA_body", c("DissOverall", "edibdiscontinuous") )
# df_bw$AOI = 'body'
# df_fbw = bind_rows(df_fw, df_bw)
# 
# ggplot(df_fbw, aes(x = edibdiscontinuous, y = Prop, group = AOI, color = AOI)) +
#   geom_smooth(method="lm") +
#   coord_cartesian(ylim=c(0,1))
# 
# df_fw = center_predictors(df_fw, c("edibdiscontinuous") )
# df_bw = center_predictors(df_bw, c("edibdiscontinuous") )
# 
# # head:
# fit_f = lmer(formula = ArcSin ~ edibdiscontinuousC + (1|Participant) + (1|Image), 
#      REML = FALSE,
#      data = df_fw)
# drop1(fit_f, test = "Chisq")
# 
# # body:
# fit_b = lmer(formula = ArcSin ~ edibdiscontinuousC + (1|Participant) + (1|Image), 
#      REML = FALSE,
#      data = df_bw)
# drop1(fit_b, test = "Chisq")

```

These results suggest that, in this data, there's no relationship between body-surveillance and *overall* time spent looking at the body.

There are two ways we might want to further break down the data, to pursue the relationship between body-surveillance and body-looking.

#### Effect of Image-Type on Looking at Face vs. Body

First, we might want to explore the effect of image-type. The body-images used in this study can broadly be broken down into three types: ones involving models that were dressed in revealing outfits (swimsuits, underwear), involving models that were dressed in typical/causal attire (blouses, jeans), and those images that are somewhere in between. 

One possibility is that face/body looking-behavior differs by image-type.

```{r,warning=FALSE, message=FALSE, echo=FALSE}
# swim_under = c("Body1.png", "Body2.png", "Body3.png", "Body4.png", "Body5.png", "Body6.png", "Body7.png", "Body20.png")
# full = c("Body9.png", "Body10.png", "Body11.png", "Body12.png", "Body14.png", "Body16.png", "Body18.png", "Body19.png")
# form_fit = c("Body8.png", "Body13.png", "Body15.png", "Body17.png", NA, NA, NA, NA)
# df_clothtype = data_frame(form_fit, full, swim_under) %>%
#   gather('ClothingType', 'Image', ... = form_fit, full, swim_under) %>%
#   na.omit()
# 
# df_bw = left_join(df_bw, df_clothtype, by = 'Image') 
# df_fw = left_join(df_fw, df_clothtype, by = 'Image') 
# df_fbw = bind_rows(df_fw, df_bw) 
# 
# ggplot(df_fbw, aes(x = edibdiscontinuous, y = Prop, group = ClothingType, color = ClothingType)) +
#   geom_smooth(method="lm") +
#   coord_cartesian(ylim=c(0,1)) +
#   facet_grid( ~ AOI) + 
#   xlab('Body-Surveillance') +
#   ylab('Proportion-Looking')
```

```{r}
# fit_b_ct = lmer(formula = ArcSin ~ edibdiscontinuousC+ClothingType + (1|Participant) + (1|Image), 
#      REML = FALSE,
#      data = df_bw)
# drop1(fit_b_ct, test = "Chisq")
# 
# fit_b_ct_int = lmer(formula = ArcSin ~ edibdiscontinuousC*ClothingType + (1|Participant) + (1|Image), 
#      REML = FALSE,
#      data = df_bw)
# drop1(fit_b_ct_int, test = "Chisq")

```

Face vs. body looking behavior does indeed change with image type: participants tend to focus more on the body in images depicting less clothed models. However, there's no interaction with the body-surveillance: that is, body-surveillance doesn't predict face vs. body looking, even within a subset of the images.


#### Timecourse of Looking at Face vs. Body

Finally, we might predict the timecourse of looking to be important here. As above, perhaps differences between participants' body surveillance only lead to differences in looking behavior for certain time-points within the trial.

```{r,warning=FALSE, message=FALSE, echo=FALSE}
# df_fb_binned = df_fb %>%
#   mutate(TimeInSec = ceiling(TimeInTrial / data_options$sample_rate) ) %>%
#   group_by(TimeInSec, Participant, Image, edibdiscontinuous, DissOverall) %>%
#   summarise(StartTime = TimeInTrial[1],
#             AOISamples = sum(IA_head, na.rm=TRUE),       # <------- will be using FACE looking
#             TotalSamples = length(IA_head), # no NAs
#             Prop = AOISamples / TotalSamples,
#             ArcSin = asin(sqrt(Prop)))
# df_fb_binned = center_predictors(df_fb_binned, c("edibdiscontinuous","DissOverall", "TimeInSec") )
# 
# plot(df_fb, data_options, dv = "IA_head", group_factor = "edibdiscontinuous", time_bin_size = 500, type = 'smoothed') +
#   ylab('Proportion Looking to Face') + labs(color='Body-Surveillance')
# # plot(df_fb, data_options, dv = "IA_body", group_factor = "edibdiscontinuous", time_bin_size = 500, type = 'smoothed') +
# #   ylab('Proportion Looking to Body') + labs(color='Body-Surveillance')
```

```{r}
# fit_main_fb = lmer(ArcSin ~ edibdiscontinuousC+TimeInSecC + (1|Participant) + (1|Image), 
#                    REML = FALSE,
#                    data = df_fb_binned)
# drop1(fit_main_fb, test = "Chisq")
# 
# fit_fb_int_time = lmer(ArcSin ~ edibdiscontinuousC*TimeInSecC + (1|Participant) + (1|Image), 
#                        REML = FALSE,
#                        data = df_fb_binned)
# drop1(fit_fb_int_time, test = "Chisq")
# tidy(fit_fb_int_time, effects= 'fixed')
```

A model which includes an interaction between body-surveillance and time-in-trial is highly signifincant. The relationship captured here can be seen from the graph: at the start of the trial, both groups initially look at the face, then move their attention to the body; as the trial continues, a large proportion of participants with high body-surveillance *stop* looking at the body, and move back to the face, while participants with low body-surveillance tend to continue to focus on the body.

This seems consistent with the results from the first part of the analysis: participants with high body-surveillance appear to suppress their initial tendency to look towards areas of insecurity.




